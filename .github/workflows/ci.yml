# Requires vars.NAME to be set as a variable.
name: CI
on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - closed
      - converted_to_draft
      - ready_for_review
    branches:
      - main
      - dev
      - backport/*.*
    paths:
      - config/**
      - spack.yaml
jobs:
  pr-ci:
    name: CI
    if: github.event.action != 'closed'
    uses: access-nri/build-cd/.github/workflows/ci.yml@v7
    with:
      model: ${{ vars.NAME }}
      # root-sbd: if different from vars.NAME
      pr: ${{ github.event.pull_request.number }}
     # TODO: Check versions are appropriate
      spack-manifest-schema-version: 1-0-7
      config-versions-schema-version: 3-0-0
      config-packages-schema-version: 1-0-0
    permissions:
      pull-requests: write
      contents: write
      statuses: write
    secrets: inherit

  pr-closed:
    name: Closed
    if: github.event.action == 'closed'
    uses: access-nri/build-cd/.github/workflows/ci-closed.yml@v7
    with:
      root-sbd: ${{ vars.NAME }} # or something else, if different from vars.NAME
    secrets: inherit
